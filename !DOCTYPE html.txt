<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Interativo: Cobrança Eficaz em Feriados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with Teal Accent -->
    <!-- Application Structure Plan: A single-page, thematic dashboard design. The structure guides the user from understanding the 'Why' (Risks & Context), through the 'How' (Strategy & Pitch Elements), to the 'What' (Practical Tools & Action Plan). This non-linear, task-oriented flow is more intuitive for a web application than the original report's linear structure. Key interactions include an interactive risk chart, a channel/template selector, and expandable strategy cards, designed to make complex information digestible and actionable. -->
    <!-- Visualization & Content Choices: 1. Report Info: Channel risks (Legal, Reputational, Intrusiveness). Goal: Compare. Viz: Horizontal Bar Chart (Chart.js). Interaction: Highlights risk levels visually. Justification: More immediate and comparable than a static table. 2. Report Info: KPIs (Delivery, Open, CTR). Goal: Inform. Viz: Bar Chart (Chart.js). Justification: Standard, clear visualization for performance metrics. 3. Report Info: Pitch essentials. Goal: Organize. Viz: Interactive cards (HTML/Tailwind). Interaction: Click-to-expand details. Justification: Breaks down strategy into memorable, interactive pieces. 4. Report Info: Channel comparison & message templates. Goal: Provide practical tools. Viz: Tabbed interface (HTML/JS). Interaction: Select channel to see pros/cons and get a tailored, copyable message. Justification: A highly usable pattern for comparing options and accessing specific tools. 5. Report Info: Message Tone Analysis. Goal: Provide feedback. Viz: Text output from LLM. Interaction: User inputs text, clicks button to get analysis. Justification: Enables real-time evaluation of user-drafted messages for appropriateness, leveraging LLM for qualitative feedback. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF7;
            color: #383838;
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: #00796B;
            border-bottom-color: #00796B;
        }
        .tab-btn {
            transition: all 0.3s;
        }
        .tab-btn.active {
            background-color: #00796B;
            color: #ffffff;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .card-glow {
            transition: box-shadow 0.3s ease-in-out;
        }
        .card-glow:hover {
            box-shadow: 0 0 25px rgba(0, 121, 107, 0.2);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .checklist-item {
            position: relative;
            padding-left: 2.5rem;
        }
        .checklist-item::before {
            content: '✓';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background-color: #E0F2F1;
            color: #00796B;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">Guia de Cobrança</h1>
            <div class="hidden md:flex space-x-8">
                <a href="#riscos" class="nav-link pb-1">Riscos</a>
                <a href="#estrategia" class="nav-link pb-1">Estratégia</a>
                <a href="#ferramentas" class="nav-link pb-1">Ferramentas</a>
                <a href="#plano" class="nav-link pb-1">Plano de Ação</a>
            </div>
        </nav>
    </header>

    <main>
        <section id="hero" class="py-16 md:py-24 text-center bg-teal-50/50">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-5xl font-bold text-teal-900 mb-4">Cobrança em Feriados: A Abordagem Certa</h2>
                <p class="text-lg md:text-xl max-w-3xl mx-auto text-gray-600">
                    Transforme um momento sensível em uma oportunidade de relacionamento. Este guia interativo, baseado em análises legais e psicológicas, mostra como criar um pitch de cobrança para feriados que maximiza a conversão e protege sua marca.
                </p>
            </div>
        </section>

        <section id="riscos" class="py-16 md:py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">O Cenário de Risco</h3>
                    <p class="mt-4 max-w-2xl mx-auto text-gray-600">
                        Entender o ambiente legal e a psicologia do consumidor é o primeiro passo para uma cobrança eficaz e ética em feriados. Uma comunicação inadequada pode gerar danos reputacionais e legais significativos. Explore o gráfico abaixo para comparar os riscos associados a cada canal de comunicação.
                    </p>
                </div>
                <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <h4 class="text-xl font-bold text-center mb-6 text-gray-700">Análise Comparativa de Risco por Canal</h4>
                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="estrategia" class="py-16 md:py-20 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">A Estratégia Vencedora</h3>
                    <p class="mt-4 max-w-2xl mx-auto text-gray-600">
                        A chave para o sucesso não é a pressão, mas a empatia e a facilidade. Um pitch de feriado eficaz deve ser um "serviço de lembrete amigável", não uma cobrança. Clique nos elementos abaixo para ver como cada componente contribui para uma abordagem de alta conversão.
                    </p>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="strategy-card bg-white p-6 rounded-2xl shadow-md card-glow cursor-pointer" data-target="detail-1">
                        <h4 class="text-lg font-bold text-teal-800 mb-2">Reconheça o Feriado</h4>
                        <p class="text-gray-600 text-sm">Mostra respeito e empatia, diminuindo a percepção de intrusão.</p>
                        <div id="detail-1" class="strategy-detail hidden mt-3 text-sm text-gray-700 border-t pt-3">Iniciar a mensagem reconhecendo o feriado estabelece um tom respeitoso, quebrando a resistência inicial do cliente.</div>
                    </div>
                    <div class="strategy-card bg-white p-6 rounded-2xl shadow-md card-glow cursor-pointer" data-target="detail-2">
                        <h4 class="text-lg font-bold text-teal-800 mb-2">Tom Empático e Suave</h4>
                        <p class="text-gray-600 text-sm">Use termos como "valor em aberto" e ofereça ajuda para construir confiança.</p>
                         <div id="detail-2" class="strategy-detail hidden mt-3 text-sm text-gray-700 border-t pt-3">A linguagem deve ser amigável e não julgadora, focando em "como podemos ajudar?" em vez de "você precisa pagar". Isso alinha-se ao estado emocional do cliente no feriado.</div>
                    </div>
                    <div class="strategy-card bg-white p-6 rounded-2xl shadow-md card-glow cursor-pointer" data-target="detail-3">
                        <h4 class="text-lg font-bold text-teal-800 mb-2">Pagamento Fácil e Rápido</h4>
                        <p class="text-gray-600 text-sm">Remova qualquer atrito. Um link direto para Pix ou boleto é essencial.</p>
                         <div id="detail-3" class="strategy-detail hidden mt-3 text-sm text-gray-700 border-t pt-3">Em um dia de descanso, a disposição para tarefas complexas é mínima. Uma chamada para ação (CTA) única, clara e para uma plataforma de pagamento de um clique maximiza a conversão.</div>
                    </div>
                    <div class="strategy-card bg-white p-6 rounded-2xl shadow-md card-glow cursor-pointer" data-target="detail-4">
                        <h4 class="text-lg font-bold text-teal-800 mb-2">Evite Urgência</h4>
                        <p class="text-gray-600 text-sm">Gatilhos de escassez ou ameaça são contraproducentes e arriscados.</p>
                        <div id="detail-4" class="strategy-detail hidden mt-3 text-sm text-gray-700 border-t pt-3">Qualquer tentativa de criar pressão em um feriado será percebida como assédio. As consequências devem ser comunicadas de forma neutra e para ações futuras (pós-feriado).</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="ferramentas" class="py-16 md:py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">Ferramentas e Canais: O Pitch Ideal</h3>
                    <p class="mt-4 max-w-2xl mx-auto text-gray-600">
                        Selecione um canal de comunicação abaixo para ver suas vantagens, desvantagens e um modelo de mensagem pronto para ser usado. Lembre-se: chamadas telefônicas devem ser estritamente evitadas.
                    </p>
                </div>

                <div class="max-w-4xl mx-auto">
                    <div class="flex justify-center items-center space-x-2 sm:space-x-4 mb-8 bg-gray-100 p-2 rounded-full">
                        <button class="tab-btn active flex-1 py-2 px-4 rounded-full text-sm sm:text-base font-semibold" data-tab="whatsapp">WhatsApp</button>
                        <button class="tab-btn flex-1 py-2 px-4 rounded-full text-sm sm:text-base font-semibold" data-tab="sms">SMS</button>
                        <button class="tab-btn flex-1 py-2 px-4 rounded-full text-sm sm:text-base font-semibold" data-tab="email">E-mail</button>
                    </div>

                    <div id="channel-content" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg transition-all duration-300">
                    </div>

                    <!-- New LLM Feature Section: Personalized Pitch Generator -->
                    <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg mt-8">
                        <h4 class="text-xl font-bold text-center mb-6 text-gray-700">Gerador de Pitch Personalizado ✨</h4>
                        <p class="text-center text-gray-600 mb-6">Descreva os detalhes e deixe a inteligência artificial criar um pitch sob medida para sua cobrança no feriado.</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label for="clientType" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Cliente:</label>
                                <input type="text" id="clientType" placeholder="Ex: Pessoa Física, Pequena Empresa" class="w-full p-2 border border-gray-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label for="debtReason" class="block text-sm font-medium text-gray-700 mb-1">Motivo da Dívida (opcional):</label>
                                <input type="text" id="debtReason" placeholder="Ex: Esquecimento, Dificuldade financeira" class="w-full p-2 border border-gray-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="desiredTone" class="block text-sm font-medium text-gray-700 mb-1">Tom Desejado:</label>
                                <select id="desiredTone" class="w-full p-2 border border-gray-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
                                    <option value="amigável e empático">Amigável e Empático</option>
                                    <option value="direto e profissional">Direto e Profissional (ainda respeitoso)</option>
                                    <option value="educado e lembrete suave">Educado e Lembrete Suave</option>
                                </select>
                            </div>
                        </div>

                        <button id="generatePitchBtn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-xl transition duration-300 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75">
                            Gerar Pitch Personalizado ✨
                        </button>
                        
                        <div id="loadingIndicator" class="text-center mt-4 hidden">
                            <div class="animate-spin inline-block w-6 h-6 border-4 border-teal-500 border-t-transparent rounded-full"></div>
                            <p class="text-gray-500 mt-2">Gerando seu pitch...</p>
                        </div>

                        <div id="generatedPitchOutput" class="mt-8 hidden">
                            <h5 class="font-semibold text-gray-700 mb-2">Pitch Gerado:</h5>
                            <div class="bg-gray-100 p-4 rounded-lg relative">
                                <pre id="generatedPitchText" class="text-gray-800 text-sm whitespace-pre-wrap font-mono"></pre>
                                <button onclick="copyToClipboard(this)" class="absolute top-2 right-2 bg-white p-2 rounded-md hover:bg-gray-200 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
                                        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                                        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zM8 2H6v1h2V2z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div id="errorFeedback" class="text-red-500 mt-4 text-center hidden"></div>
                    </div>
                    <!-- End New LLM Feature Section -->

                    <!-- New LLM Feature Section: Message Tone Analyzer -->
                    <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg mt-8">
                        <h4 class="text-xl font-bold text-center mb-6 text-gray-700">Analisador de Tom da Mensagem ✨</h4>
                        <p class="text-center text-gray-600 mb-6">Cole sua mensagem aqui para obter uma análise do tom e sugestões de aprimoramento, especialmente para um feriado.</p>
                        
                        <textarea id="messageToAnalyze" rows="6" placeholder="Cole sua mensagem de cobrança aqui..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-teal-500 focus:border-teal-500 mb-4"></textarea>

                        <button id="analyzeToneBtn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-xl transition duration-300 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75">
                            Analisar Tom da Mensagem ✨
                        </button>
                        
                        <div id="loadingToneIndicator" class="text-center mt-4 hidden">
                            <div class="animate-spin inline-block w-6 h-6 border-4 border-teal-500 border-t-transparent rounded-full"></div>
                            <p class="text-gray-500 mt-2">Analisando o tom...</p>
                        </div>

                        <div id="toneAnalysisOutput" class="mt-8 hidden">
                            <h5 class="font-semibold text-gray-700 mb-2">Resultado da Análise:</h5>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <p id="toneAnalysisText" class="text-gray-800 text-sm whitespace-pre-wrap"></p>
                            </div>
                        </div>
                        <div id="errorToneFeedback" class="text-red-500 mt-4 text-center hidden"></div>
                    </div>
                    <!-- End New LLM Feature Section -->
                </div>

                <div class="text-center mt-16">
                     <h4 class="text-2xl font-bold text-gray-800">KPIs de Referência</h4>
                     <p class="mt-2 max-w-2xl mx-auto text-gray-600">Monitore estas métricas para avaliar o sucesso da sua campanha e refinar estratégias futuras.</p>
                </div>
                <div class="mt-8 bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="kpiChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="plano" class="py-16 md:py-20 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">Plano de Ação Estratégico</h3>
                    <p class="mt-4 max-w-2xl mx-auto text-gray-600">Siga este checklist para garantir uma execução impecável, segura e eficaz da sua comunicação de cobrança no feriado.</p>
                </div>

                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-white p-8 rounded-2xl shadow-lg">
                        <h4 class="text-xl font-bold text-teal-800 mb-6">1. Pré-Feriado: Preparação</h4>
                        <ul class="space-y-4 text-gray-700">
                            <li class="checklist-item">Segmentar a base de devedores.</li>
                            <li class="checklist-item">Verificar listas de "Não Me Ligue".</li>
                            <li class="checklist-item">Aprovar os modelos de mensagem.</li>
                            <li class="checklist-item">Configurar a automação para o feriado.</li>
                            <li class="checklist-item">Testar os links de pagamento.</li>
                        </ul>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg">
                        <h4 class="text-xl font-bold text-teal-800 mb-6">2. No Feriado: Execução Cautelosa</h4>
                        <ul class="space-y-4 text-gray-700">
                            <li class="checklist-item">Disparar mensagens na "janela de menor ofensa" (10h-15h).</li>
                            <li class="checklist-item">Monitorar pagamentos de forma passiva.</li>
                            <li class="checklist-item font-bold text-red-700">Não realizar NENHUMA chamada telefônica de cobrança.</li>
                            <li class="checklist-item">Não enviar mensagens de acompanhamento agressivas.</li>
                        </ul>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg">
                        <h4 class="text-xl font-bold text-teal-800 mb-6">3. Pós-Feriado: Análise</h4>
                        <ul class="space-y-4 text-gray-700">
                            <li class="checklist-item">Retomar as práticas padrão no dia útil seguinte.</li>
                            <li class="checklist-item">Analisar a taxa de conversão da campanha.</li>
                            <li class="checklist-item">Medir KPIs (abertura, clique, etc.).</li>
                            <li class="checklist-item">Coletar feedback qualitativo dos clientes.</li>
                            <li class="checklist-item">Refinar a estratégia para futuros feriados.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2024 Guia Interativo de Cobrança. Todos os direitos reservados.</p>
            <p class="text-sm text-gray-400 mt-2">Esta aplicação é uma ferramenta de visualização de dados e não constitui aconselhamento jurídico.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const channelData = {
                whatsapp: {
                    title: 'WhatsApp: Comunicação Pessoal e Direta',
                    pros: 'Alta taxa de abertura (>90%), interação imediata, percepção mais pessoal.',
                    cons: 'Exige consentimento explícito e templates pré-aprovados. Risco de ser visto como invasivo se não for bem gerenciado.',
                    message: `Olá [Nome Cliente], sabemos que hoje é feriado, mas queríamos lembrar que o valor de R$ [Valor] referente a [Produto/Serviço] está em aberto.\n\nPara sua conveniência, você pode regularizar facilmente por este link: [Link de Pagamento].\n\nCaso precise de ajuda, nossa equipe estará disponível no próximo dia útil. Tenha um ótimo feriado! [Nome da Empresa]`
                },
                sms: {
                    title: 'SMS: Lembretes Rápidos e Concisos',
                    pros: 'Taxa de leitura altíssima (>95%), entrega rápida, baixo custo e ideal para mensagens curtas.',
                    cons: 'Limitação de caracteres, pode parecer impessoal e menos eficaz para negociações complexas.',
                    message: `Olá [Nome Cliente], lembramos amigavelmente sobre o débito de R$ [Valor]. Pague com facilidade aqui: [Link Pagamento]. Em caso de dúvidas, nosso time retorna no próximo dia útil. Bom feriado! [Nome Empresa]`
                },
                email: {
                    title: 'E-mail: Formalidade e Detalhes',
                    pros: 'Permite mensagens mais longas e detalhadas, ideal para anexar documentos ou propostas formais.',
                    cons: 'Taxa de abertura imediata menor. Pode ser ignorado ou ir para a caixa de spam.',
                    message: `Assunto: Lembrete Amigável - Seu Débito - [Nome Empresa]\n\nPrezado(a) [Nome Cliente],\n\nEsperamos que esteja aproveitando o feriado!\n\nGostaríamos de informar, de forma amigável, que o pagamento de R$ [Valor], referente ao [Produto/Serviço], com vencimento em [Data], ainda não foi identificado.\n\nPara facilitar sua regularização, você pode acessar seu boleto/Pix diretamente por aqui: [Link de Pagamento].\n\nEntendemos que imprevistos acontecem. Se precisar discutir opções de pagamento, nossa equipe estará à disposição a partir do próximo dia útil.\n\nDesejamos um excelente feriado!\n\nAtenciosamente,\n[Nome da Empresa]`
                }
            };
            
            function updateChannelContent(tab) {
                const data = channelData[tab];
                const contentDiv = document.getElementById('channel-content');
                
                contentDiv.innerHTML = `
                    <h4 class="text-xl font-bold text-gray-800 mb-4">${data.title}</h4>
                    <div class="grid md:grid-cols-2 gap-6 text-sm">
                        <div>
                            <h5 class="font-semibold text-green-700 mb-2">Vantagens:</h5>
                            <p class="text-gray-600">${data.pros}</p>
                        </div>
                        <div>
                            <h5 class="font-semibold text-red-700 mb-2">Desvantagens e Cuidados:</h5>
                            <p class="text-gray-600">${data.cons}</p>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h5 class="font-semibold text-gray-700 mb-2">Modelo de Mensagem:</h5>
                        <div class="bg-gray-100 p-4 rounded-lg relative">
                            <pre class="text-gray-800 text-sm whitespace-pre-wrap font-mono">${data.message}</pre>
                            <button onclick="copyToClipboard(this)" class="absolute top-2 right-2 bg-white p-2 rounded-md hover:bg-gray-200 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
                                  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                                  <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zM8 2H6v1h2V2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }

            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    updateChannelContent(tab.dataset.tab);
                });
            });

            updateChannelContent('whatsapp');
            
            const strategyCards = document.querySelectorAll('.strategy-card');
            strategyCards.forEach(card => {
                card.addEventListener('click', () => {
                    const detailId = card.dataset.target;
                    const detailEl = document.getElementById(detailId);
                    const allDetails = document.querySelectorAll('.strategy-detail');
                    
                    const isOpening = detailEl.classList.contains('hidden');

                    allDetails.forEach(d => d.classList.add('hidden'));
                    
                    if (isOpening) {
                        detailEl.classList.remove('hidden');
                    }
                });
            });

            const riskCtx = document.getElementById('riskChart').getContext('2d');
            new Chart(riskCtx, {
                type: 'bar',
                data: {
                    labels: ['Chamada Telefônica', 'WhatsApp', 'SMS', 'E-mail'],
                    datasets: [{
                        label: 'Risco Legal/Reputacional',
                        data: [95, 50, 40, 20],
                        backgroundColor: ['#E57373', '#FFB74D', '#FFB74D', '#81C784'],
                        borderColor: ['#D32F2F', '#F57C00', '#F57C00', '#388E3C'],
                        borderWidth: 1
                    }, {
                        label: 'Percepção de Intrusividade',
                        data: [100, 70, 30, 15],
                        backgroundColor: ['#EF9A9A', '#FFCC80', '#FFCC80', '#A5D6A7'],
                        borderColor: ['#D32F2F', '#F57C00', '#F57C00', '#388E3C'],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    maintainAspectRatio: false,
                    responsive: true,
                    scales: {
                        x: {
                            max: 100,
                            title: {
                                display: true,
                                text: 'Nível de Risco / Intrusividade (0-100)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false,
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        let riskLevel;
                                        if(context.parsed.x > 80) riskLevel = 'Muito Alto';
                                        else if (context.parsed.x > 60) riskLevel = 'Alto';
                                        else if (context.parsed.x > 40) riskLevel = 'Médio';
                                        else if (context.parsed.x > 20) riskLevel = 'Baixo';
                                        else riskLevel = 'Muito Baixo';
                                        label += `${context.parsed.x} (${riskLevel})`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            const kpiCtx = document.getElementById('kpiChart').getContext('2d');
            new Chart(kpiCtx, {
                type: 'bar',
                data: {
                    labels: ['Taxa de Entrega (SMS/Email)', 'Taxa de Abertura (WhatsApp/SMS)', 'Taxa de Cliques (Média)'],
                    datasets: [{
                        label: 'Benchmark de Performance (%)',
                        data: [95, 90, 35],
                        backgroundColor: ['#4DB6AC', '#80CBC4', '#B2DFDB'],
                        borderColor: '#00897B',
                        borderWidth: 1
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Percentual (%)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                           display: false
                        }
                    }
                }
            });

            const clientTypeInput = document.getElementById('clientType');
            const debtReasonInput = document.getElementById('debtReason');
            const desiredToneSelect = document.getElementById('desiredTone');
            const generatePitchBtn = document.getElementById('generatePitchBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const generatedPitchOutput = document.getElementById('generatedPitchOutput');
            const generatedPitchText = document.getElementById('generatedPitchText');
            const errorFeedback = document.getElementById('errorFeedback');

            generatePitchBtn.addEventListener('click', async () => {
                const clientType = clientTypeInput.value.trim();
                const debtReason = debtReasonInput.value.trim();
                const desiredTone = desiredToneSelect.value;

                if (!clientType) {
                    errorFeedback.textContent = 'Por favor, informe o tipo de cliente para gerar o pitch.';
                    errorFeedback.classList.remove('hidden');
                    return;
                } else {
                    errorFeedback.classList.add('hidden');
                }

                loadingIndicator.classList.remove('hidden');
                generatedPitchOutput.classList.add('hidden');
                generatedPitchText.textContent = ''; // Clear previous content

                const prompt = `Crie um pitch de cobrança para ser enviado em um feriado, para o seguinte cenário:
                Tipo de Cliente: ${clientType}
                Motivo da Dívida (se fornecido): ${debtReason || 'Não especificado'}
                Tom Desejado: ${desiredTone}
                
                Inclua os seguintes elementos:
                - Reconhecimento do feriado (ex: "Esperamos que esteja aproveitando o feriado!").
                - Um tom ${desiredTone} (ex: "lembrete amigável", "valor em aberto").
                - Facilidade de pagamento (mencione um link direto para Pix ou boleto).
                - Evite urgência, pressão ou ameaças.
                - Assine com "Nome da Empresa".
                - Use placeholders como [Nome Cliente], [Valor], [Produto/Serviço], [Link de Pagamento], [Data].
                
                Formate o pitch para ser conciso, mas completo, adequado para um SMS ou WhatsApp.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Leave as-is for Canvas to provide
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        generatedPitchText.textContent = text;
                        generatedPitchOutput.classList.remove('hidden');
                    } else {
                        console.error('API response structure unexpected:', result);
                        errorFeedback.textContent = 'Erro ao gerar o pitch. Por favor, tente novamente.';
                        errorFeedback.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    errorFeedback.textContent = 'Falha na comunicação com a IA. Verifique sua conexão ou tente novamente mais tarde.';
                    errorFeedback.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            });

            // Tone Analyzer LLM Feature
            const messageToAnalyzeInput = document.getElementById('messageToAnalyze');
            const analyzeToneBtn = document.getElementById('analyzeToneBtn');
            const loadingToneIndicator = document.getElementById('loadingToneIndicator');
            const toneAnalysisOutput = document.getElementById('toneAnalysisOutput');
            const toneAnalysisText = document.getElementById('toneAnalysisText');
            const errorToneFeedback = document.getElementById('errorToneFeedback');

            analyzeToneBtn.addEventListener('click', async () => {
                const message = messageToAnalyzeInput.value.trim();

                if (!message) {
                    errorToneFeedback.textContent = 'Por favor, insira uma mensagem para analisar o tom.';
                    errorToneFeedback.classList.remove('hidden');
                    return;
                } else {
                    errorToneFeedback.classList.add('hidden');
                }

                loadingToneIndicator.classList.remove('hidden');
                toneAnalysisOutput.classList.add('hidden');
                toneAnalysisText.textContent = ''; // Clear previous content

                const prompt = `Analise o tom da seguinte mensagem de cobrança, considerando que será enviada em um feriado. Forneça uma avaliação concisa do tom (ex: 'Muito agressivo', 'Um pouco seco', 'Adequado e empático', 'Muito suave, pode não ser eficaz'). Se o tom não for ideal para um feriado, sugira brevemente como melhorá-lo, focando em empatia, respeito pelo feriado e clareza. Mensagem: ${message}`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Leave as-is for Canvas to provide
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        toneAnalysisText.textContent = text;
                        toneAnalysisOutput.classList.remove('hidden');
                    } else {
                        console.error('API response structure unexpected:', result);
                        errorToneFeedback.textContent = 'Erro ao analisar o tom. Por favor, tente novamente.';
                        errorToneFeedback.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    errorToneFeedback.textContent = 'Falha na comunicação com a IA. Verifique sua conexão ou tente novamente mais tarde.';
                    errorToneFeedback.classList.remove('hidden');
                } finally {
                    loadingToneIndicator.classList.add('hidden');
                }
            });
        });

        function copyToClipboard(button) {
            const pre = button.previousElementSibling;
            const text = pre.innerText;
            
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                const originalIcon = button.innerHTML;
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-lg text-green-500" viewBox="0 0 16 16">
                      <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022z"/>
                    </svg>
                `;
                setTimeout(() => { button.innerHTML = originalIcon; }, 2000);
            } catch (err) {
                console.error('Falha ao copiar texto: ', err);
            }
            document.body.removeChild(textarea);
        }
    </script>
</body>
</html>
